## 将来実装メモ：ロケーション切り替え（入庫・ロス・棚卸）

### 1. 目的
- 出庫と同様に、POS側で任意ロケーションを選択し入庫・ロス・棚卸の処理や一覧を切り替えられるようにする。
- タイルを開いた直後は **必ず POS セッションのロケーション** を選択済みとする。

### 2. 現状の課題（共通）
| 機能 | 主な課題 |
|------|----------|
| 入庫 | GraphQL `locations` が 0 件になるショップがあり、モーダル候補が表示できない。リスト/確定処理の参照ロケーションがセッション固定。 |
| ロス | 登録・履歴ともにセッションロケーション固定。モーダルで選択しても実際の処理ロケーションに反映されない。 |
| 棚卸 | `readInventoryCounts()` 後のフィルタがセッションロケーション固定。モーダルで選択した値が一覧に反映されない。 |

### 3. 対応方針
1. **ロケーション候補の取得方法を統一**  
   - 管理画面設定（表示ロケーション等）やバックエンドAPIを介して全ロケーションを取得できるようにして、POSでも利用可能にする。
2. **処理フローごとのロケーション状態管理を整理**  
   - 各機能で「セッションロケーション」「手動選択ロケーション」を appState 等で持ち、常に手動優先→セッション fallback にそろえる。
   - タイル表示直後はセッションロケーションをセットし、モーダルで更新した場合は appState に保存して処理全体で利用。
3. **一覧・登録・確定処理すべてでロケーションIDを受け渡し**  
   - 入庫：コンディション → シップメント選択 → 商品リストまで通しで手動ロケーションに切り替わるようにする。  
   - ロス：コンディション → 商品リスト → 履歴一覧の取得条件を統一。  
   - 棚卸：タイル → 棚卸ID一覧 → 商品リストで同一ロケーションを利用するよう `readInventoryCounts()` などを修正。

### 4. 実装時のチェックリスト
- [ ] 管理画面設定または専用APIで全ロケーション一覧を取得できるか確認。
- [ ] タイル初期表示時にセッションロケーションが確実に選択状態になるかテスト。
- [ ] モーダルでロケーション変更後に各画面・処理が正しいロケーションを参照するか（入庫・ロス・棚卸のそれぞれ）。
- [ ] 出庫との共通コード化（必要なら `useManualLocation` のような共通フックを検討）。
- [ ] 既存のロケーション設定（visibleLocationIds 等）との整合性確認。

### 5. メモ
- POS GraphQL API は権限やプランによって返るロケーション数が異なるケースあり。空配列になる場合はバックエンド側で補完する。
- 将来実装する際には、過去の draft や appState に残る手動ロケーション ID の初期化も考慮する。
