# 入出庫・ロス・棚卸 履歴モーダル・CSV トンマナ現状まとめ

管理画面の「入出庫履歴」「ロス履歴」「棚卸履歴」について、商品モーダルとCSVの列構成・表記を整理したものです。トンマナ統一時の参照用です。

---

## 1. 入出庫履歴（app.history.tsx）

### 1.1 モーダル（商品リスト）

| 項目 | 内容 |
|------|------|
| **サマリー欄**（テーブル上） | 履歴ID, 名称, 日付, 出庫元, 入庫先, ステータス, 数量 |
| **テーブル列**（左→右） | **配送ID** → **配送ステータス** → 商品名 → SKU → JAN → オプション1 → オプション2 → オプション3 → **予定数** → **入庫数** |
| **件数表示** | 「合計: N件」 |
| **予定外** | 行の背景を薄赤（#ffe6e6）、列なし |
| **単一/複数** | 単一・複数とも同じ列構成（配送ID・配送ステータスは複数時のみ値あり、単一は「-」） |

### 1.2 CSV（モーダルからダウンロード）

| 列順 | ヘッダー |
|------|----------|
| 1 | 履歴ID |
| 2 | 名称 |
| 3 | 日付 |
| 4 | 出庫元 |
| 5 | 入庫先 |
| 6 | ステータス |
| 7 | 配送ID |
| 8 | 配送ステータス |
| 9 | 商品名 |
| 10 | SKU |
| 11 | JAN |
| 12 | オプション1 |
| 13 | オプション2 |
| 14 | オプション3 |
| 15 | 予定数 |
| 16 | 入庫数 |
| 17 | 種別（「通常」/「予定外入庫」） |

### 1.3 CSV（一覧から一括ダウンロード）

※モーダルCSVと同一列構成（2026年2月統一済み）

| 列順 | ヘッダー |
|------|----------|
| 1 | 履歴ID |
| 2 | 名称 |
| 3 | 日付 |
| 4 | 出庫元 |
| 5 | 入庫先 |
| 6 | ステータス |
| 7 | 配送ID |
| 8 | 配送ステータス |
| 9 | 商品名 |
| 10 | SKU |
| 11 | JAN |
| 12 | オプション1 |
| 13 | オプション2 |
| 14 | オプション3 |
| 15 | 予定数 |
| 16 | 入庫数 |
| 17 | 種別 |

---

## 2. ロス履歴（app.loss.tsx）

### 2.1 モーダル（商品リスト）

| 項目 | 内容 |
|------|------|
| **サマリー欄** | 履歴ID, 名称, 日付, ロケーション, 理由, 担当者, ステータス, （キャンセル日時）, 数量 |
| **テーブル列**（左→右） | **商品名** → SKU → JAN → オプション1 → オプション2 → オプション3 → **数量** |
| **件数表示** | 「合計: N件」 |
| **グループ列** | なし（ロスは単一単位のため） |
| **予定外** | なし |

### 2.2 CSV（モーダルからダウンロード）

| 列順 | ヘッダー |
|------|----------|
| 1 | 履歴ID |
| 2 | 名称 |
| 3 | 日付 |
| 4 | ロケーション |
| 5 | 理由 |
| 6 | 担当者 |
| 7 | ステータス |
| 8 | 商品名 |
| 9 | SKU |
| 10 | JAN |
| 11 | オプション1 |
| 12 | オプション2 |
| 13 | オプション3 |
| 14 | 数量 |

### 2.3 CSV（一覧から一括ダウンロード）

※モーダルCSVと同一列構成（2026年2月統一済み）

| 列順 | ヘッダー |
|------|----------|
| 1 | 履歴ID |
| 2 | 名称 |
| 3 | 日付 |
| 4 | ロケーション |
| 5 | 理由 |
| 6 | 担当者 |
| 7 | ステータス |
| 8 | 商品名 |
| 9 | SKU |
| 10 | JAN |
| 11 | オプション1 |
| 12 | オプション2 |
| 13 | オプション3 |
| 14 | 数量 |

---

## 3. 棚卸履歴（app.inventory-count.tsx）

### 3.1 モーダル（商品リスト）

| 項目 | 内容 |
|------|------|
| **サマリー欄** | 棚卸ID, ロケーション, 商品グループ, 進捗状況（グループごと 完了済み/未完了）, ステータス, 作成日時, 完了日時 |
| **テーブル列**（複数グループ・単一とも） | **商品グループ**（＋完了/未完了の表示） → 商品名 → SKU → JAN → オプション1 → オプション2 → オプション3 → **在庫** → **実数** → **差分** |
| **件数表示** | 複数時「商品グループごとの進捗: N/Mグループ完了」＋ 実数/在庫数 等 |
| **予定外** | 行の背景を薄赤、列はなし（CSVには「予定外」列あり） |

### 3.2 CSV（モーダルからダウンロード）・3.3 CSV（一覧から「詳細含む」でダウンロード）

※列順・名称を統一（2026年2月）。モーダル・一覧詳細とも同一。

| 列順 | ヘッダー |
|------|----------|
| 1 | 棚卸ID |
| 2 | 名称 |
| 3 | 日付（作成日時の日付部分） |
| 4 | 完了日（完了日時の日付部分） |
| 5 | ロケーション |
| 6 | 商品グループ |
| 7 | ステータス |
| 8 | 商品名 |
| 9 | SKU |
| 10 | JAN |
| 11 | オプション1 |
| 12 | オプション2 |
| 13 | オプション3 |
| 14 | 在庫 |
| 15 | 実数 |
| 16 | 差分 |
| 17 | 種別（予定外のとき「予定外」） |

**一覧から「詳細なし」でダウンロード**の場合の列: 棚卸ID, 名称, 日付, 完了日, ロケーション, 商品グループ, ステータス（7列）。

---

## 4. 比較サマリー（商品まわり）

| 項目 | 入出庫履歴 | ロス履歴 | 棚卸履歴 |
|------|------------|----------|----------|
| **モーダル：グループ/配送列** | 配送ID, 配送ステータス | なし | 商品グループ（＋完了/未完了） |
| **モーダル：商品列** | 商品名, SKU, JAN, オプション1〜3 | 同左 | 同左 |
| **モーダル：数量系** | 予定数, 入庫数 | 数量 | 在庫, 実数, 差分 |
| **モーダル：予定外** | 背景色のみ（種別はCSVのみ） | なし | 背景色のみ（CSVに「予定外」列あり） |
| **CSV：商品名/SKU** | 商品名・SKU の2列 | 同左 | **商品名/SKU の1列** |
| **CSV：在庫まわり** | 予定数・入庫数（モーダルCSVのみ種別あり） | 数量のみ | 現在在庫・実数・差分・予定外 |
| **CSV：一括の列数** | 一括は「数量」1列（予定数/入庫数/種別なし） | 一括はオプション1〜3なし | 詳細時は商品名/SKU・現在在庫・実数・差分あり |

---

## 5. トンマナ統一の際の論点（案）

1. **商品識別**
   - モーダル表は **商品名・SKU・JAN・オプション1〜3** を共通にする（現状ほぼ共通）。
   - CSVは **商品名とSKUを分離** するか **1列「商品名/SKU」** に揃えるか（棚卸だけ1列）。

2. **数量まわり**
   - 入出庫: 予定数・入庫数（＋種別）
   - ロス: 数量
   - 棚卸: 在庫/現在在庫・実数・差分（＋予定外）
   - 列名を「在庫」「現在在庫」などで表記統一するか。

3. **グループ/配送の列**
   - 入出庫: 配送ID, 配送ステータス
   - ロス: なし
   - 棚卸: 商品グループ, ステータス（完了/進行中）
   - 「グループ識別列＋ステータス列」の並び・表記を揃えるか。

4. **CSVの一括とモーダル**
   - 入出庫: 一括は「数量」1列のみで予定数/入庫数/種別なし。
   - ロス: 一括でオプション1〜3がない。
   - モーダルCSVと一括CSVで「列の有無」を揃えるか。

5. **予定外・種別**
   - 入出庫: モーダルは背景のみ、CSVに「種別」列。
   - 棚卸: モーダルは背景のみ、CSVに「予定外」列。
   - モーダル表にも「種別」/「予定外」列を設けるか。

---

**作成日**: 2026年2月  
**対象ファイル**: `app/routes/app.history.tsx`, `app/routes/app.loss.tsx`, `app/routes/app.inventory-count.tsx`
