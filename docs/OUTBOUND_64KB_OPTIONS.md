# 出庫タイル 64 KB 制限の選択肢

## 状況

- POS UI Extension の **モーダル用スクリプトは 64 KB 以下** という制限がある。
- 現在の `stock-transfer-tile` のモーダル（出庫＋入庫＋履歴を1つにまとめた実装）は **65 KB** で制限超過。
- コメント削除・空白削減などのソース削減では、バンドル後のサイズがほとんど減っていない（バンドラの最適化の影響）。

## 結論

**「出庫・入庫・履歴をすべて 1 つのタイルの 1 つのモーダルに詰め込む」実装は、現状の 64 KB 制限では不可能です。**

機能を減らすか、**複数の拡張（タイル／モーダル）に分ける**必要があります。

---

## 選択肢

### 選択肢 A: このタイルは「出庫のみ」にする（推奨）

- **やること**: `stock-transfer-tile` のモーダルから **入庫まわりをすべて削除** し、出庫専用にする。
- **理由**: 入庫用の拡張 **`stock-transfer-inbound`** がすでにあるため、入庫はそちらのタイルで行う運用にできる。
- **ユーザー体験**:
  - ホームにタイルが 2 つ：「出庫（在庫処理）」と「入庫（在庫移管）」など。
  - 出庫したいとき → 出庫タイルをタップ → 条件・一覧・履歴はすべてそのモーダル内。
  - 入庫したいとき → 入庫タイルをタップ → 入庫用モーダル。
- **効果**: モーダルから InboundList / InboundConditions / InboundShipmentSelection などを外せるため、**64 KB 以内に収まる可能性が高い**。

---

### 選択肢 B: 出庫を 2 つの拡張に分ける

- **やること**:
  - 拡張 1: 「出庫（条件＋一覧）」＝ 新規出庫の条件・品目一覧・確定まで。
  - 拡張 2: 「出庫履歴」＝ 履歴一覧・詳細表示。
- **ユーザー体験**: タイルが 2 つになるか、出庫タイルから「履歴」を選んだときだけ別モーダル（別拡張）が開く形。
- **注意**: 設計・導線・状態の受け渡しが複雑になる。

---

### 選択肢 C: 動的 import（コード分割）を試す

- **やること**: 出庫一覧・履歴などの重い画面を `import()` で遅延読み込みし、**初回ロードのバンドルだけ** 64 KB 以下にする。
- **効果**: Shopify の制限が「初回ダウンロード 64 KB」なら有効。**「ロードされるスクリプト合計 64 KB」** なら、遅延読み込みしても総量が変わらず効果なし。
- **不明点**: POS の 64 KB が「どの時点の何を指すか」がドキュメントで要確認。

---

## 推奨

**まず選択肢 A（このタイルは出庫のみ、入庫は既存の inbound タイル）を採用する**のが現実的です。

1. 既に `stock-transfer-inbound` がある。
2. 出庫だけに絞れば、モーダル内のコード量を大きく減らせる。
3. 出庫・入庫の導線が「タイル 2 つ」で明確になる。

選択肢 A を進める場合、`stock-transfer-tile` の `Modal.jsx` から入庫関連の画面・処理・定数を削除し、メニューは「出庫」のみにしたうえで、再度ビルドして 64 KB を満たすか確認する形になります。
