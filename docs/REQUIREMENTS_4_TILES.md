# POS 4タイル構成・メニューなし方針

**最終更新**: 2026年2月  
**前提**: REQUIREMENTS_FINAL.md の要件を満たしつつ、64 KB 制限や実装のしやすさのため、1タイル1機能・メニューなしの構成に変更する。

---

## 1. 方針

| タイル | ラベル（例） | 開いたときの画面 | 備考 |
|--------|--------------|------------------|------|
| **在庫処理 出庫** | 在庫処理 / 出庫 | 出庫コンディション（宛先・配送情報等）から開始 | メニューなし。タップで即コンディション |
| **在庫処理 入庫** | 在庫処理 / 入庫 | 入庫コンディション（入庫ID一覧）から開始 | メニューなし。入庫は別拡張で実装予定 |
| **在庫調整 ロス** | 在庫調整 / ロス | ロスコンディション（ロケーション・日付・理由等）から開始 | メニューなし |
| **在庫調整 棚卸** | 在庫調整 / 棚卸 | 棚卸コンディション（棚卸ID一覧）から開始 | メニューなし。棚卸専用拡張に分離 |

- **メニューを挟まない**: タイルを開いたら、いきなり各機能の「コンディション画面」が表示され、そこから次へ・履歴へと進む。
- **戻る**: コンディション画面で「戻る」を押したときはモーダルを閉じる（POS の `action.dismissModal` 等を使用）。

---

## 2. 各拡張の変更内容

### 2.1 stock-transfer-tile（在庫処理 出庫）

- **Tile.jsx**: `heading="在庫処理"`, `subheading="出庫"`.
- **Modal.jsx**:
  - 初期画面を **出庫コンディション** に変更（`useNavStack({ id: SCREENS.OUTBOUND_COND })`）。
  - メニュー画面（MenuScreen）を廃止。出庫のみのフロー（コンディション → 一覧 → 履歴等）に限定。
  - 入庫関連の画面・処理・定数を削除し、出庫専用にする（64 KB 対策も兼ねる）。
- **戻る**: 出庫コンディションで「戻る」→ モーダルを閉じる。

### 2.2 stock-transfer-inbound（在庫処理 入庫）

- **Tile.jsx**: `heading="在庫処理"`, `subheading="入庫"`.
- **Modal.jsx**: 現状はプレースホルダーのため、将来的に「入庫コンディション（入庫ID一覧）から開始」する実装に差し替える。入庫の画面・ロジックは出庫タイル側から移行するか、別途実装する。

### 2.3 stock-transfer-loss（在庫調整 ロス）

- **Tile.jsx**: `heading="在庫調整"`, `subheading="ロス"`.
- **Modal.jsx**:
  - 初期 view を **VIEW.LOSS** に変更（`useState(VIEW.LOSS)`）。メニュー（ロス/棚卸の選択）を廃止。
  - 棚卸（VIEW.STOCKTAKE, StocktakeScreen）をこの拡張から削除。ロス専用にする。
- **戻る**: ロスコンディションで「戻る」→ モーダルを閉じる。

### 2.4 stock-transfer-stocktake（在庫調整 棚卸）※新規拡張

- **新規拡張**: 棚卸専用。`stock-transfer-loss` から棚卸用の画面・API をコピーして作成。
- **Tile.jsx**: `heading="在庫調整"`, `subheading="棚卸"`.
- **Modal.jsx**: StocktakeScreen のみ。初期 view は棚卸コンディション（棚卸ID一覧）から開始。
- **戻る**: 棚卸コンディションで「戻る」→ モーダルを閉じる。

---

## 3. 実装時の注意

- **モーダルを閉じる**: POS UI Extension では `shopify?.action?.dismissModal?.()` など、提供されている API でモーダルを閉じる。コンディション画面の「戻る」にその処理を渡す。
- **入庫タイル**: 現時点ではタイル文言のみ「在庫処理 入庫」にし、モーダルはプレースホルダーのままでも可。実装時は出庫タイルから Inbound* を移すか、新規実装する。
- **REQUIREMENTS_FINAL.md**: 管理画面・ロス登録・棚卸の要件はそのまま。POS の「タイル構成」と「開いたときの画面」だけを本ドキュメントのとおりに変更する。
